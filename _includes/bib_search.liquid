{% if site.bib_search %}
  <script src="{{ '/assets/js/bibsearch.js' | relative_url | bust_file_cache }}" type="module"></script>

  <div class="bibsearch-row" style="align-items:flex-start; flex-wrap:wrap; gap:1rem;">
    <input
      type="text"
      id="bibsearch"
      spellcheck="false"
      autocomplete="off"
      class="search bibsearch-form-input"
      placeholder="Type to filter"
      style="margin-bottom:0;"
    >

    {% assign sources = site.data.total_citations.sources %}
    {% if sources %}
      <div style="flex:1 1 auto; min-width:300px; max-width:650px;">
        <table class="styled-table styled-table--small">
          <thead>
            <tr>
              <th>Source</th>
              <th>Citations</th>
              <th>h</th>
              <th>i10</th>
              <th>Updated</th>
            </tr>
          </thead>
          <tbody>
            {% assign preferred_order = "google_scholar,scopus,researchgate" | split: "," %}
            {% for key in preferred_order %}
              {% assign row = sources[key] %}
              {% if row %}
                <tr>
                  <td>
                    {% case key %}
                      {% when "google_scholar" %}Google Scholar
                      {% when "scopus" %}Scopus
                      {% when "researchgate" %}ResearchGate
                      {% else %}{{ key | replace: "_", " " | capitalize }}
                    {% endcase %}
                  </td>
                  <td>{{ row.total_citations | default: "—" }}</td>
                  <td>{{ row.h_index | default: "—" }}</td>
                  <td>{% if row.i10_index %}{{ row.i10_index }}{% else %}—{% endif %}</td>
                  <td>{% if row.updated %}{{ row.updated }}{% else %}—{% endif %}</td>
                </tr>
              {% endif %}
            {% endfor %}

            {%- comment -%}
            Render any remaining sources not listed in the preferred order
            {%- endcomment -%}
            {% for pair in sources %}
              {% assign key = pair[0] %}
              {% unless preferred_order contains key %}
                {% assign row = pair[1] %}
                <tr>
                  <td>{{ key | replace: "_", " " | capitalize }}</td>
                  <td>{{ row.total_citations | default: "—" }}</td>
                  <td>{{ row.h_index | default: "—" }}</td>
                  <td>{% if row.i10_index %}{{ row.i10_index }}{% else %}—{% endif %}</td>
                  <td>{% if row.updated %}{{ row.updated }}{% else %}—{% endif %}</td>
                </tr>
              {% endunless %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>
{% endif %}
